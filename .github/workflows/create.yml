name: create torrent

on:
  workflow_dispatch:
  push:

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - uses: actions/checkout@v4
        with:
          submodules: recursive
      - name: Install dependencies
        run: |
          sudo apt-get install -y transmission-cli
          cd submodules/mktorrent
          make
          mv mktorrent ../../
      - name: download files and create torrent
        run: ./create_monero_torrent.sh
      - name: create release notes
        run: |
          {
            echo "### Torrent info"
            echo '```'
            transmission-show watch/*
            echo '```'
            echo "### ðŸ§² Link"
            echo '```'
            transmission-show -m watch/*
            echo '```'
          } >> release-notes.md
      - name: Release
        uses: softprops/action-gh-release@v2
        if: github.ref_type == 'tag'
        with:
          body_path: release-notes.md
          files: watch/*
